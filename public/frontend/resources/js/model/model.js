var currentBeer;var BeerModel = Backbone.Model.extend({	initialize:function(){		var beer = this;		this.bind('change:thinrating', function(){			if (beer.get('rating')) {				var jqxhrPut;				beer.get('rating').rating = beer.get('thinrating'),				url = 'http://' + apiIp +':3000/ratings/' + beer.get('rating')._id, beer.get('rating');				jqxhrPut = $.ajax({					url: url,					type: 'PUT',					data: beer.get('rating'),					success: function(data) {						if (data.rating && data.user && data.beernr) {							beer.set('rating', {rating: data.rating, user: data.user, beernr: parseInt(data.beernr, 10), _id: beer.get('rating')._id});							console.log('Rating saved!');						} else {							alert('Det gick inte att rösta. Skyll på Daniel.');						}						console.log(data);					},					error : function() {					alert('Det gick inte att rösta. Skyll på Daniel.');					}				});			} else {				var ratingObj = {					rating: this.get('thinrating'),					user: getUser()._id,					beernr: parseInt(this.get('beernr'), 10)				},				jqxhrPost = $.post('http://' + apiIp +':3000/ratings/', ratingObj, function(data) {					if (data.rating && data.user && data.beernr && data._id) {						beer.set('rating', {rating: data.rating, user: data.user, beernr: parseInt(data.beernr, 10), _id: data._id});						console.log('Rating saved!');					} else {						alert('Det gick inte att rösta. Skyll på Daniel.');					}					console.log(data);				})				.error(function() { alert('Det gick inte att rösta. Skyll på Daniel.'); });				}		});	},	populate: function(beer, index){		var jqxhrGetRating,		backbonebeer = this;		this.set({name:beer.name, picture:beer.picture, abv:beer.abv, brewery:beer.brewery, beernr:beer.beernr, _id:beer._id, index:index} );			jqxhrGetRating  = $.get("http://" + apiIp +":3000/ratings/" + this.get('beernr') + '/' + getUser()._id, function(rating) {				if (rating && rating.rating) {					backbonebeer.set('rating', rating);				}			}).error(function() {				console.log("error");			});		}});var BeerCollection = Backbone.Collection.extend({	initialize:function(){		var coll = this;		// this.bind('change:rating', function (e) {		// 	console.log('rating changed', e);		// 	coll.trigger('rerender');		// });	},	populateCollection: function(beerList){		for(var i=0; i < beerList.length; i++)		{			var model = new BeerModel();			model.populate(beerList[i], i);			this.add(model);		}	},	setCurrentBeer:function(index){		var coll = this;				if( index > ( this.length - 1 ) ){			index = 0;		}		else if( index < 0 ){			index = this.length - 1;		}				this.currentBeer = this.at(index);		if (this.currentBeer && !this.currentBeer.attributes.rating) {			var jqxhrGetBeers = $.get('http://' + apiIp + ':3000/ratings/' + this.currentBeer.attributes.beernr + '/' + getUser()._id, function(rating) {				if(rating) {					coll.currentBeer.attributes.rating = rating;					console.log(rating);				}				coll.trigger('updateBeer');			}).error(function() {				coll.trigger('updateBeer');				console.log('error');			});		} else {			coll.trigger('updateBeer');		}		//coll.trigger('updateBeer');	},	getCurrentBeer:function(){		return this.currentBeer;	}});